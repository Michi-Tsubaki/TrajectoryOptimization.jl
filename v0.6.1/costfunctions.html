<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2. Setting up an Objective · TrajectoryOptimization</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><script src="../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">TrajectoryOptimization</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="model.html">1. Setting Up a Dynamics Model</a></li><li class="is-active"><a class="tocitem" href="costfunctions.html">2. Setting up an Objective</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Cost-functions"><span>Cost functions</span></a></li><li><a class="tocitem" href="#Objective"><span>Objective</span></a></li></ul></li><li><a class="tocitem" href="constraints.html">3. Creating Constraints</a></li><li><a class="tocitem" href="creating_problems.html">4. Setting up a Problem</a></li></ul></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="costfunction_interface.html">Cost Function Interface</a></li><li><a class="tocitem" href="constraint_interface.html">Constraint Interface</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="cost_api.html">Cost Functions and Objectives</a></li><li><a class="tocitem" href="constraint_api.html">Constraints</a></li><li><a class="tocitem" href="problem.html">Problem</a></li><li><a class="tocitem" href="rotations.html">Optimizing Rotations</a></li><li><a class="tocitem" href="dynamics.html">Evaluating the Dynamics and Jacobians</a></li><li><a class="tocitem" href="nlp.html">Converting to an NLP</a></li></ul></li><li><a class="tocitem" href="examples.html">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li class="is-active"><a href="costfunctions.html">2. Setting up an Objective</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="costfunctions.html">2. Setting up an Objective</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/master/docs/src/costfunctions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="objective_section"><a class="docs-heading-anchor" href="#objective_section">2. Setting up an Objective</a><a id="objective_section-1"></a><a class="docs-heading-anchor-permalink" href="#objective_section" title="Permalink"></a></h1><ul><li><a href="costfunctions.html#objective_section">2. Setting up an Objective</a></li><li class="no-marker"><ul><li><a href="costfunctions.html#Overview">Overview</a></li><li><a href="costfunctions.html#Cost-functions">Cost functions</a></li><li><a href="costfunctions.html#Objective">Objective</a></li></ul></li></ul><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>All trajectory optimization problems require a cost function at each stage of the trajectory. Cost functions must be scalar-valued. We assume general cost functions of the form,</p><p class="math-container">\[\ell_f(x_N) + \sum_{k=1}^{N-1} \ell_k(x_k,u_k) dt\]</p><p>It is very important to note that <span>$\ell_k(x_k,u_k)$</span> is ONLY a function of <span>$x_k$</span> and <span>$u_k$</span>, i.e. no coupling across time-steps is permitted. This is a requirement for Differential Dynamic Programming methods such as iLQR, but could be relaxed for methods that parameterize both states and controls, such as DIRCOL. In general, any coupling between adjacent time-steps can be resolved by augmenting the state and defining the appropriate dynamics (this is the method we use to solve minimum time problems).</p><p>In general, trajectory optimization will take a second order Taylor series approximation of the cost function, resulting in a quadratic cost function of the form</p><p class="math-container">\[x_N^T Q_f x_N + q_f^T x_N + \sum_{k=1}^{N-1} x_k^T Q_k x_k + q_k^T x_k + u_k^T R_k u_k + r_k^T u_k + u_k^T H_k x_k\]</p><p>This type of quadratic cost is typical for trajectory optimization problems, especially when Q is positive semi-definite and R is positive definite, which is strictly convex. These problems behave well and reduce the computational requirements of taking second-order Taylor series expansions of the cost at each iteration.</p><p>In TrajectoryOptimization.jl we differentiate between the entire objective and the cost functions at each time step. We use <code>Objective</code> to describe the function that is being minimized, which typically consists of a sum of cost functions, with potentially some additional terms (as is the case with augmented Lagrangian objectives). Describing the Objective as a sum of individual functions allows the solvers to more efficiently compute the gradient and Hessian of the entire cost, which is block-diagonal given the Markovianity of the problem.</p><h2 id="Cost-functions"><a class="docs-heading-anchor" href="#Cost-functions">Cost functions</a><a id="Cost-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Cost-functions" title="Permalink"></a></h2><p>While TrajectoryOptimization allows for general nonlinear cost function in principle, currently only quadratic cost functions are implemented (implementing nonlinear cost functions is a great way to contribute!). All cost functions inherit from the general <code>CostFunction</code> type.</p><p>Since quadratic costs are the most standard cost function they excellent place to start. Let&#39;s assume we are creating an LQR tracking cost of the form</p><p class="math-container">\[(x_N - x_f)^T Q_f (x_N - x_f) + \sum_{k=1}^{N-1} (x_k - x_f)^T Q (x_k - x_f) + u_k^T R u_k\]</p><p>for the simple cartpole with the goal of doing a swing-up. To do this we have very convenient method <a href="cost_api.html#TrajectoryOptimization.LQRCost"><code>LQRCost</code></a>.</p><pre><code class="language-julia hljs">using LinearAlgebra, StaticArrays
n,m = 4,1
Q = Diagonal(@SVector fill(0.1,n))
R = Diagonal(@SVector fill(0.1,m))
Qf = Diagonal(@SVector fill(1000,n))
xf = @SVector [0,π,0,0]
costfun = LQRCost(Q,R,xf)
costfun_term = LQRCost(Qf,R*0,xf,terminal=true)</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>It is HIGHLY recommended to specify any special structure, such as <code>Diagonal</code>, especially since these matrices are almost always diagonal. See Julia&#39;s built-in <code>LinearAlgebra</code> module for more specialized matrix types.</p></div></div><p>This constructor actually does a simple conversion to turn our cost function into either the generic <a href="cost_api.html#TrajectoryOptimization.QuadraticCost"><code>QuadraticCost</code></a> or a <a href="cost_api.html#TrajectoryOptimization.DiagonalCost"><code>DiagonalCost</code></a>. We could do this ourselves:</p><pre><code class="language-julia hljs">H = @SMatrix zeros(m,n)
q = -Q*xf
r = @SVector zeros(m)
c = xf&#39;Q*xf/2
qf = -Qf*xf
cf = xf&#39;Qf*xf/2
costfun      = QuadraticCost(Q, R, H, q, r, c)
costfun_term = QuadraticCost(Qf, R*0, H, qf, r*0, cf)</code></pre><p>The <code>QuadraticCost</code> constructor also supports keyword arguments and one that allows for only <code>Q,q</code> and <code>c</code>.:</p><pre><code class="language-julia hljs">costfun = QuadraticCost(Q, R, q=q, c=c)</code></pre><h2 id="Objective"><a class="docs-heading-anchor" href="#Objective">Objective</a><a id="Objective-1"></a><a class="docs-heading-anchor-permalink" href="#Objective" title="Permalink"></a></h2><p>Once we have defined the cost function, we can create an objective for our problem by simply copying over all time steps (except for the terminal).</p><pre><code class="language-julia hljs"># Create an objective from a single cost function
N = 51
obj = Objective(costfun, costfun_term, N)</code></pre><p>There&#39;s also a convenient constructor that skips all the previous steps and builds the objective directly, see<a href="cost_api.html#TrajectoryOptimization.LQRObjective"><code>LQRObjective</code></a></p><pre><code class="language-julia hljs">obj = LQRObjective(Q, R, Qf, xf, N)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="model.html">« 1. Setting Up a Dynamics Model</a><a class="docs-footer-nextpage" href="constraints.html">3. Creating Constraints »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Tuesday 18 January 2022 20:56">Tuesday 18 January 2022</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
